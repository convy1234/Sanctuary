<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Sanctuary{% endblock %}</title>

    <style>
        :root {
            --bg: #f4f6fb;
            --card: #ffffff;
            --text: #0f172a;
            --muted: #6b7280;
            --primary: #0f4c81;
            --primary-soft: rgba(15, 76, 129, 0.12);
            --border: #e6ebf4;
            --radius: 12px;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: "Inter", "Segoe UI", Arial, sans-serif;
            background: linear-gradient(180deg, #f5f7fb 0%, #eef2fb 100%);
            color: var(--text);
            line-height: 1.6;
        }

        a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }
        a:hover { text-decoration: underline; }

        /* TOP BAR */
        header {
            background: #fff;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 40;
            box-shadow: 0 6px 12px rgba(15,23,42,0.06);
        }
        .topbar {
            margin: 0 auto;
            padding: 14px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            font-size: 18px;
            color: var(--text);
        }
        .brand-icon {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            display: grid;
            place-items: center;
            background: var(--primary);
            color: #fff;
            font-weight: 800;
        }
        .nav-links {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .nav-links a {
            color: var(--muted);
            font-weight: 600;
        }
        .nav-links a.active { color: var(--primary); }
        .user-area {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #e0e7ff;
            display: grid;
            place-items: center;
            color: #111827;
            font-weight: 700;
        }
        .pill {
            background: var(--primary);
            color: #fff;
            padding: 8px 14px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 700;
            white-space: nowrap;
        }
        .pill:hover { opacity: 0.95; text-decoration: none; }

        /* MAIN */
        main {
            margin: 24px auto 60px;
            padding: 0 20px;
        }

        /* CARDS */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 22px;
            margin-bottom: 18px;
            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
        }
        .card h1,
        .card h2,
        .card h3 { margin-top: 0; }

        /* TEXT */
        .muted { color: var(--muted); font-size: 14px; }
        .error { color: #b91c1c; font-weight: 600; }
        .success { color: #15803d; font-weight: 600; }

        /* FORMS */
        form { display: grid; gap: 14px; }
        label { display: grid; gap: 6px; font-weight: 600; font-size: 14px; }
        input, textarea, select {
            padding: 12px 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
            background: #fff;
            transition: border-color 0.15s, box-shadow 0.15s;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-soft);
        }
        textarea { resize: vertical; min-height: 100px; }
        button {
            padding: 12px 16px;
            font-size: 15px;
            border: none;
            border-radius: 10px;
            background: var(--primary);
            color: #fff;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.05s, opacity 0.15s;
        }
        button:hover { opacity: 0.95; }
        button:active { transform: translateY(1px); }

        /* LISTS */
        .list { list-style: none; padding: 0; margin: 0; }
        .list li { padding: 10px 0; border-bottom: 1px dashed var(--border); }
        .list li:last-child { border-bottom: none; }

        .actions { display: flex; gap: 12px; flex-wrap: wrap; }

        .endpoint {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 14px;
        }

        @media (max-width: 720px) {
            .topbar { flex-direction: column; align-items: flex-start; }
            .user-area { width: 100%; justify-content: space-between; }
            main { padding: 0 16px; }
        }
    </style>
    <style>
    .dashboard-shell {
        display: grid;
        grid-template-columns: 220px 1fr;
        gap: 20px;
    }
    .sidebar {
        background: linear-gradient(180deg, #0f4c81 0%, #09315c 100%);
        color: #e8f0fb;
        padding: 20px 14px;
        border-radius: 14px;
        min-height: 100%;
    }
    .sidebar h2 {
        margin: 0 0 16px;
        font-size: 18px;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .sidebar a {
        color: #e8f0fb;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 10px;
        margin-bottom: 6px;
    }
    .sidebar a:hover,
    .sidebar a.active {
        background: rgba(255,255,255,0.12);
        text-decoration: none;
    }
    .content-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 14px;
    }
    .stat-card {
        background: #fff;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 18px;
        box-shadow: 0 8px 20px rgba(15,23,42,0.06);
        display: grid;
        gap: 6px;
    }
    .stat-label {
        font-size: 13px;
        letter-spacing: 0.4px;
        color: var(--muted);
        text-transform: uppercase;
        font-weight: 700;
    }
    .stat-value {
        font-size: 26px;
        font-weight: 700;
        color: var(--text);
    }
    .quick-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
    }
    .quick-tile {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px;
        background: #f8fbff;
        text-align: center;
    }
    .quick-tile a {
        display: block;
        font-weight: 700;
        color: #0f4c81;
    }
    .section-card {
        background: #fff;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 18px;
        box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
    }
    .list-row {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px dashed var(--border);
    }
    .list-row:last-child { border-bottom: none; }
    .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        background: #ecf2ff;
        color: #0f4c81;
        font-size: 12px;
        font-weight: 700;
    }
    @media (max-width: 900px) {
        .dashboard-shell { grid-template-columns: 1fr; }
        .sidebar { display: flex; overflow-x: auto; }
        .sidebar a { margin-bottom: 0; white-space: nowrap; }
    }
</style>
    {% block head_extra %}{% endblock %}
</head>

<body>
<header>
    <div class="topbar">
        <div class="brand">
            <span class="brand-icon">&#9962;</span>
            {% if request.user.is_authenticated and request.user.organization %}
                <a class="nav-brand" href="{% url 'dashboard' %}">{{ request.user.organization.name }}</a>
            {% else %}
                <a class="nav-brand" href="{% url 'dashboard' %}">Sanctuary</a>
            {% endif %}
        </div>

        <!-- UPDATED NAVIGATION LINKS -->
        <div class="nav-links">
            <!-- Dashboard link -->
            <a class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}" 
               href="{% url 'dashboard' %}">Dashboard</a>
            
            <!-- Members link (UPDATED) -->
            {% if request.user.is_authenticated and request.user.organization %}
                <a class="{% if 'member_' in request.resolver_match.url_name or request.resolver_match.url_name == 'member_list' %}active{% endif %}" 
                   href="{% url 'member_list' %}">Members</a>
            {% else %}
                <a href="{% url 'organizations_list' %}">Churches</a>
            {% endif %}
            
            <!-- API Docs link -->
            <a class="{% if request.resolver_match.url_name == 'api_docs' %}active{% endif %}" 
               href="{% url 'api_docs' %}">API Docs</a>
        </div>

        <div class="user-area">
            {% if request.user.is_authenticated %}
                {% if request.user.organization %}
                    <a class="pill" href="{% url 'send_invite' request.user.organization.id %}">+ Invite</a>
                {% else %}
                    <a class="pill" href="{% url 'accept_invite' %}">Accept Invite</a>
                {% endif %}
                <span class="muted">{{ request.user.email }}</span>
                <div class="avatar">{{ request.user.first_name|default:request.user.email|slice:":2"|upper }}</div>
                <a class="pill" href="{% url 'logout' %}">Logout</a>
            {% else %}
                <a href="{% url 'login' %}">Login</a>
                <a class="pill" href="{% url 'accept_invite' %}">Accept invite</a>
            {% endif %}
        </div>
    </div>
</header>

<main>
        <div class="dashboard-shell">
            {% if request.user.is_authenticated and request.user.organization %}
            <!-- UPDATED SIDEBAR -->
            <aside class="sidebar">
                <h2>&#9962; {{ request.user.organization.name|default:"Sanctuary" }}</h2>
                
                <!-- Dashboard -->
                <a class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}" 
                   href="{% url 'dashboard' %}">&#128203; Dashboard</a>
                
                <!-- Members (UPDATED) -->
                <a class="{% if 'member_' in request.resolver_match.url_name or request.resolver_match.url_name == 'member_list' %}active{% endif %}" 
                   href="{% url 'member_list' %}">&#128101; Members</a>
                
                <!-- Future Features -->
                <a href="{% url 'voucher_list' %}">&#128197; Request</a>
                <a href="{% url 'inventory_dashboard' %}">&#128230; Inventory</a>
                <a href="#">&#128179; Finances</a>
                <a href="#">&#128719; Room Booking</a>
                <a href="#">&#128221; Reports</a>
                <a href="#">&#9881; Settings</a>
            </aside>
            {% endif %}
            <div class="dashboard-main">
                {% block content %}{% endblock %}
            </div>
        </div>
    
</main>
</body>
</html>